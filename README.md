# Public Transport Route Planner for Wrocław
App generated by AI during prompt engineering training
A web-based application that helps users find optimal public transport routes in Wrocław by providing real-time departure information and interactive route visualization on a map.

This application combines a Python Flask backend API with an interactive frontend map interface to help users plan their public transport journeys in Wrocław. The system uses GTFS (General Transit Feed Specification) data from Wrocław's public transport system to provide accurate route and schedule information. Users can select start and end points on an interactive map, specify departure times, and receive detailed route suggestions including bus/tram stops, arrival times, and route visualization.

## Repository Structure
```
.
├── frontend/                      # Frontend web application files
│   ├── front.html                # Main application interface
│   ├── js/                       # JavaScript modules
│   │   ├── busData.js           # Mock bus data for testing
│   │   └── routeMap.js          # Interactive map functionality
│   ├── script.js                # Main application logic
│   └── styles.css               # Application styling
├── src/                         # Backend Python application
│   └── public_transport_api/    # Main API package
│       ├── controllers/         # API endpoint handlers
│       ├── services/           # Business logic implementation
│       ├── database_utils.py   # Database interaction utilities
│       └── main.py            # Flask application entry point
├── tests/                      # Test suite
├── tools/                      # Utility scripts and tools
│   ├── database_tool.py       # GTFS data import tool
│   └── concat-project.sh      # Project file concatenation utility
└── OtwartyWroclaw_rozklad_jazdy_GTFS/  # GTFS data files
```

## Usage Instructions
### Prerequisites
- Python 3.8 or higher
- SQLite3
- Node.js (for development)
- Web browser with JavaScript enabled

Required Python packages:
```
Flask>=2.0.0
geopy>=2.0.0
pandas>=2.3.0
sqlite3
```

### Installation

1. Clone the repository:
```bash
git clone [repository-url]
cd public-transport-planner
```

2. Set up Python virtual environment:
```bash
# MacOS/Linux
python3 -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
.\venv\Scripts\activate
```

3. Install Python dependencies:
```bash
pip install -r tools/requirements.txt
```

4. Import GTFS data:
```bash
python tools/database_tool.py
```

5. Start the Flask server:
```bash
cd src
python -m flask run
```

### Quick Start

1. Open `frontend/front.html` in a web browser
2. Click on the map to set start point
3. Click again to set end point
4. Set departure time using the time picker
5. Click "Search" to find available routes
6. View route details in the sidebar and on the map

### More Detailed Examples

1. Finding the next available bus:
```javascript
// Example API call
const response = await fetch('http://localhost:5000/public_transport/city/Wroclaw/closest_departures?start_coordinates=51.1079,17.0385&end_coordinates=51.1100,17.0400&start_time=2024-02-20T14:30:00Z');
```

2. Getting specific trip details:
```javascript
const tripDetails = await fetch('http://localhost:5000/public_transport/city/Wroclaw/trip/123');
```

### Troubleshooting

1. Database Connection Issues
```bash
# Verify database exists
ls trips.sqlite

# Check database schema
sqlite3 trips.sqlite ".schema"
```

2. API Connection Issues
- Ensure Flask server is running on port 5000
- Check browser console for CORS errors
- Verify API endpoint URLs match your environment

3. Map Display Issues
- Clear browser cache
- Ensure Leaflet.js CDN is accessible
- Check browser console for JavaScript errors

## Data Flow

The application processes user input through the frontend map interface, sends coordinates and timing data to the Flask backend, which queries the GTFS database for route information and returns optimized journey suggestions.

```ascii
User Input -> Frontend Map
     |
     v
API Request -> Flask Backend
     |
     v
GTFS Database Query
     |
     v
Route Optimization
     |
     v
JSON Response -> Frontend
     |
     v
Map Visualization
```

Key component interactions:
1. Frontend captures user input via interactive map
2. RouteMap.js handles map interactions and marker management
3. script.js coordinates API calls and response handling
4. Flask backend processes requests through controller endpoints
5. Database utilities query GTFS data for route information
6. Response data is transformed into route visualization
7. Map updates with route and stop markers
